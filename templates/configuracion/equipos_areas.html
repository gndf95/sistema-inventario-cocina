{% extends "base.html" %}

{% block title %}Configuraci√≥n Equipos por Almacenes - Sistema de Inventario{% endblock %}

{% block content %}
<div class="container-fluid px-2 px-md-4">
    <div class="row mb-3">
        <div class="col-12 col-md-8">
            <h1 class="h3 h2-md">Configuraci√≥n de Equipos por Almacenes</h1>
            <p class="text-muted">Asigna cada equipo a los almacenes correspondientes</p>
        </div>
        <div class="col-12 col-md-4 text-md-end">
            <a href="{{ url_for('configuracion') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Volver a Configuraci√≥n
            </a>
        </div>
    </div>

    <!-- Informaci√≥n de almacenes -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-light">
                <div class="card-body">
                    <h5>3 Almacenes que Prestan Equipos:</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <h6 class="text-primary">üõí Almac√©n Compras</h6>
                            <small>Utensilios generales, herramientas b√°sicas, contenedores</small>
                        </div>
                        <div class="col-md-4">
                            <h6 class="text-success">üß™ Almac√©n Calidad e Higiene</h6>
                            <small>Instrumentos de medici√≥n, equipo de control, balanzas</small>
                        </div>
                        <div class="col-md-4">
                            <h6 class="text-warning">‚ö° Almac√©n Equipo Especial</h6>
                            <small>Maquinaria especializada, herramientas t√©cnicas</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filtros -->
    <div class="card mb-3">
        <div class="card-body p-2 p-md-3">
            <div class="row g-2">
                <div class="col-12 col-md-4">
                    <input type="text" class="form-control form-control-sm" id="buscarEquipo"
                           placeholder="Buscar equipo...">
                </div>
                <div class="col-6 col-md-3">
                    <select class="form-select form-select-sm" id="filtroAlmacen">
                        <option value="">Todos los almacenes</option>
                        <option value="Almac√©n Compras">Almac√©n Compras</option>
                        <option value="Almac√©n Calidad e Higiene">Almac√©n Calidad e Higiene</option>
                        <option value="Almac√©n Equipo Especial">Almac√©n Equipo Especial</option>
                        <option value="sin-almacen">Sin almac√©n asignado</option>
                    </select>
                </div>
                <div class="col-6 col-md-3">
                    <select class="form-select form-select-sm" id="filtroCategoria">
                        <option value="">Todas las categor√≠as</option>
                        {% set categorias_mostradas = [] %}
                        {% for equipo in equipos %}
                            {% if equipo.categoria and equipo.categoria.nombre not in categorias_mostradas %}
                                {% set _ = categorias_mostradas.append(equipo.categoria.nombre) %}
                                <option value="{{ equipo.categoria.nombre }}">{{ equipo.categoria.nombre }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
                <div class="col-12 col-md-2">
                    <button type="button" class="btn btn-secondary btn-sm w-100" onclick="limpiarFiltros()">
                        <i class="fas fa-times"></i> Limpiar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla de equipos -->
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>C√≥digo</th>
                    <th>Equipo</th>
                    <th>Categor√≠a</th>
                    <th>Stock</th>
                    <th class="text-center">üõí Compras</th>
                    <th class="text-center">üß™ Calidad</th>
                    <th class="text-center">‚ö° Especial</th>
                    <th>Ubicaci√≥n Actual</th>
                </tr>
            </thead>
            <tbody>
                {% for equipo in equipos %}
                <tr class="equipo-row" data-equipo-id="{{ equipo.id }}">
                    <td>{{ equipo.codigo }}</td>
                    <td>
                        <strong>{{ equipo.nombre }}</strong>
                        {% if equipo.descripcion %}
                        <br><small class="text-muted">{{ equipo.descripcion[:50] }}...</small>
                        {% endif %}
                    </td>
                    <td>{{ equipo.categoria.nombre if equipo.categoria else '-' }}</td>
                    <td>
                        <span class="badge bg-primary">{{ equipo.cantidad_total }}</span>
                        <span class="badge bg-success">{{ equipo.cantidad_disponible }} disp.</span>
                    </td>